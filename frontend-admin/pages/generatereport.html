<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Reports - Church Management</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .report-controls {
            display: flex;
            gap: 15px;
            align-items: end;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .page-header h2 {
            margin: 0;
        }
        
        .report-container {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .report-header {
            border-bottom: 2px solid #4361ee;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        
        .report-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .report-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .report-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .report-table th, .report-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .report-table .total-row {
            background: #e8f4fd;
            font-weight: bold;
        }
        
        .report-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .previous-reports-section {
            margin: 20px 0;
        }
        
        .reports-list {
            display: grid;
            gap: 10px;
        }
        
        .report-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        }
        
        .report-item.pending {
            background: #fff9e6;
            border-left: 4px solid #ffc107;
        }
        
        .report-item.overdue {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .report-item.generated {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }
        
        .report-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .report-status.pending {
            background: #ffc107;
            color: #000;
        }
        
        .report-status.overdue {
            background: #dc3545;
            color: white;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .report-status.generated {
            background: #4caf50;
            color: white;
        }
        
        .report-dates {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-top: 8px;
        }
        
        .report-dates small {
            color: #666;
            font-size: 13px;
        }
        
        .text-warning {
            color: #ff9800 !important;
        }
        
        .report-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .report-item-summary {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .chart-container {
            height: 300px;
            margin-top: 15px;
        }
        
        #report-notes, #report-notes-input {
            width: 100%;
            resize: vertical;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: inherit;
            font-size: 14px;
        }
        
        #report-notes {
            min-height: 100px;
        }
        
        #report-notes-input, #modal-notes-input {
            min-height: 60px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .close-modal {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        @media (max-width: 768px) {
            .report-sections {
                grid-template-columns: 1fr;
            }
            
            .report-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }

        /* ACNC-style Compact Table Styles */
        .reports-table.compact-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .reports-table.compact-table thead {
            background: #4361ee;
            color: white;
        }

        .reports-table.compact-table th,
        .reports-table.compact-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .reports-table.compact-table th {
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .reports-table.compact-table tbody tr:hover {
            background: #f8f9fa;
        }

        .reports-table.compact-table .report-name {
            font-weight: 500;
            color: #333;
        }

        .reports-table.compact-table .due-date,
        .reports-table.compact-table .submitted-date {
            color: #666;
            font-size: 14px;
        }

        .reports-table.compact-table .submitted-date.pending {
            color: #ff9800;
            font-weight: 500;
        }

        .reports-table.compact-table .submitted-date.overdue {
            color: #dc3545;
            font-weight: 500;
            animation: pulse 2s infinite;
        }

        .reports-table.compact-table .submitted-date.generated {
            color: #4caf50;
            font-weight: 500;
        }

        .reports-table.compact-table .action-cell {
            text-align: center;
        }

        .btn-compact {
            padding: 6px 12px;
            font-size: 13px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-compact.btn-primary {
            background: #4361ee;
            color: white;
        }

        .btn-compact.btn-primary:hover {
            background: #3651d4;
        }

        .btn-compact.btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-compact.btn-danger:hover {
            background: #c82333;
        }

        /* Report Overlay Styles */
        .report-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .report-overlay-content {
            background: white;
            border-radius: 10px;
            width: 95%;
            max-width: 1200px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .report-overlay-header {
            padding: 20px;
            border-bottom: 2px solid #4361ee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
        }

        .report-overlay-header h3 {
            margin: 0;
            color: #333;
        }

        .report-overlay-actions {
            display: flex;
            gap: 10px;
        }

        .report-overlay-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .report-overlay .report-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .report-overlay .report-section.full-width {
            grid-column: 1 / -1;
        }

        /* Print-specific styles for overlay */
        @media print {
            .report-overlay {
                position: static !important;
                background: white !important;
                padding: 0 !important;
                display: block !important;
            }

            .report-overlay-content {
                box-shadow: none !important;
                border-radius: 0 !important;
                max-height: none !important;
                width: 100% !important;
                max-width: none !important;
            }

            .report-overlay-header {
                border-bottom: 2px solid #000 !important;
                background: white !important;
            }

            .report-overlay-actions {
                display: none !important;
            }

            .report-overlay-body {
                overflow: visible !important;
            }

            /* Hide everything else when printing overlay */
            body > *:not(.report-overlay) {
                display: none !important;
            }

            /* Church header print styles */
            .church-header, .church-header-overlay {
                text-align: center !important;
                margin-bottom: 20px !important;
            }

            .church-header h2, .church-header-overlay h2 {
                color: #000 !important;
                font-size: 16px !important;
            }

            .church-header p, .church-header-overlay p {
                color: #000 !important;
                font-size: 12px !important;
            }

            .church-header hr {
                border: 1px solid #000 !important;
            }
        }

        /* Church header styles */
        .church-header, .church-header-overlay {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .church-header h2, .church-header-overlay h2 {
            margin: 0;
            color: #1976d2;
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .church-header p, .church-header-overlay p {
            margin: 5px 0;
            color: #666;
            font-size: 14px;
        }

        .church-header hr {
            margin: 15px 0;
            border: 1px solid #ddd;
        }

        /* Mobile responsive for compact table */
        @media (max-width: 768px) {
            .reports-table.compact-table {
                font-size: 13px;
            }

            .reports-table.compact-table th,
            .reports-table.compact-table td {
                padding: 8px 10px;
            }

            .reports-table.compact-table .report-name {
                font-size: 12px;
            }

            .btn-compact {
                padding: 4px 8px;
                font-size: 11px;
            }

            .report-overlay-content {
                width: 98%;
                margin: 10px;
            }

            .report-overlay-header {
                padding: 15px;
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .report-overlay-actions {
                justify-content: center;
            }

            .report-overlay .report-sections {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="page-content">
        <div class="page-header">
            <h2>Financial Reports</h2>
            <button class="btn btn-primary" onclick="reportsPage.openGenerateModalWithDefaults()">
                <i class="fas fa-plus"></i> Generate New Report
            </button>
        </div>

        <!-- Australian Financial Year Information Panel -->
        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
            <h4 style="margin: 0 0 10px 0; color: #1976d2;">
                <i class="fas fa-calendar-alt"></i> Australian Financial Year Information
            </h4>
            <p style="margin: 0 0 10px 0;">Financial Year runs from <strong>July 1</strong> to <strong>June 30</strong></p>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 10px;">
                <div style="background: white; padding: 10px; border-radius: 6px; text-align: center; font-size: 14px;">
                    <strong>Q1</strong><br>Jul - Sep
                </div>
                <div style="background: white; padding: 10px; border-radius: 6px; text-align: center; font-size: 14px;">
                    <strong>Q2</strong><br>Oct - Dec
                </div>
                <div style="background: white; padding: 10px; border-radius: 6px; text-align: center; font-size: 14px;">
                    <strong>Q3</strong><br>Jan - Mar
                </div>
                <div style="background: white; padding: 10px; border-radius: 6px; text-align: center; font-size: 14px;">
                    <strong>Q4</strong><br>Apr - Jun
                </div>
            </div>
        </div>

        <div class="previous-reports-section">
            <h3>All Reports</h3>
            <div id="all-reports" class="reports-list"></div>
        </div>



        <div id="report-content" class="report-container">
            <div class="report-header">
                <h3 id="report-title">Financial Report</h3>
                <p id="report-period-display" class="report-period">Period: </p>
            </div>

            <div class="report-sections">
                <div class="report-section">
                    <h4>Income Summary & Categories</h4>
                    <table class="report-table">
                        <thead>
                            <tr><th>Category</th><th>Amount</th></tr>
                        </thead>
                        <tbody id="income-categories"></tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td><strong>Total Income</strong></td>
                                <td id="total-income"><strong>$0.00</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="report-section">
                    <h4>Expenses by Category</h4>
                    <table class="report-table">
                        <thead>
                            <tr><th>Category</th><th>Amount</th></tr>
                        </thead>
                        <tbody id="expense-categories"></tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td><strong>Total Expenses</strong></td>
                                <td id="total-expenses"><strong>$0.00</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="report-section">
                    <h4>Financial Summary</h4>
                    <table class="report-table">
                        <tr>
                            <td>Total Income</td>
                            <td id="new-total-income">$0.00</td>
                        </tr>
                        <tr>
                            <td>Total Expenses</td>
                            <td id="new-total-expenses">$0.00</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>Net Balance</strong></td>
                            <td id="new-total-balance"><strong>$0.00</strong></td>
                        </tr>
                    </table>
                </div>

                <div class="report-section">
                    <h4>Cash Flow</h4>
                    <table class="report-table">
                        <tr>
                            <td>Starting Balance (Previous FY)</td>
                            <td id="starting-balance">$0.00</td>
                        </tr>
                        <tbody id="previous-quarters-breakdown">
                            <!-- Previous quarters will be inserted here -->
                        </tbody>
                        <tr style="border-top: 2px solid #ddd;">
                            <td><strong>Previous Balance (Cumulative)</strong></td>
                            <td id="previous-balance"><strong>$0.00</strong></td>
                        </tr>
                        <tr>
                            <td>+ Current Period Income</td>
                            <td id="report-income">+$0.00</td>
                        </tr>
                        <tr>
                            <td>- Current Period Expenses</td>
                            <td id="report-expenses">-$0.00</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>Current Balance</strong></td>
                            <td id="current-balance"><strong>$0.00</strong></td>
                        </tr>
                    </table>
                </div>

                <div class="report-section full-width">
                    <h4>Asset Calculation</h4>
                    <table class="report-table">
                        <tr>
                            <td>Starting Asset (Previous FY End)</td>
                            <td id="starting-asset">$0.00</td>
                        </tr>
                        <tbody id="quarterly-asset-breakdown">
                            <!-- Quarterly asset breakdown will be inserted here -->
                        </tbody>
                        <tr style="border-top: 2px solid #ddd;">
                            <td><strong>Previous Asset (Cumulative)</strong></td>
                            <td id="previous-asset"><strong>$0.00</strong></td>
                        </tr>
                        <tr>
                            <td>+ Current Period Net Balance</td>
                            <td id="current-period-net">+$0.00</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>Total Asset at End</strong></td>
                            <td id="total-asset-end"><strong>$0.00</strong></td>
                        </tr>
                    </table>
                </div>

                <div class="report-section full-width">
                    <h4>Notes / Comments</h4>
                    <textarea id="report-notes" class="form-control" rows="4" placeholder="Add notes or comments about this report..."></textarea>
                    <div style="margin-top: 10px;">
                        <button id="save-notes-btn" class="btn btn-sm btn-secondary">Save Notes</button>
                    </div>
                </div>

                <div class="report-section full-width">
                    <h4>Monthly Overview</h4>
                    <div class="chart-container">
                        <canvas id="monthly-chart"></canvas>
                    </div>
                </div>
            </div>

            <div class="report-actions">
                <button id="print-report-btn" class="btn btn-primary">Print Report</button>
                <button id="export-report-btn" class="btn btn-success">Export PDF</button>
            </div>
        </div>
    </div>

    <!-- Generate Report Modal -->
    <div id="generate-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 id="modal-title">Generate Report</h3>
                <span class="close-modal" onclick="reportsPage.closeGenerateModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="report-type" class="form-label">Report Type *</label>
                    <select id="report-type" class="form-control" onchange="reportsPage.handleReportTypeChange()">
                        <option value="quarterly">Quarterly Report</option>
                        <option value="annual">Annual Report</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="report-year" class="form-label">Financial Year *</label>
                    <select id="report-year" class="form-control" onchange="reportsPage.handleYearChange()">
                        <!-- Years will be populated by JavaScript -->
                    </select>
                    <small style="color: #666;">Australian Financial Year (July 1 - June 30)</small>
                </div>
                
                <div class="form-group" id="quarter-selection">
                    <label for="report-quarter" class="form-label">Quarter *</label>
                    <select id="report-quarter" class="form-control" onchange="reportsPage.handleQuarterChange()">
                        <option value="1">Q1 (Jul - Sep)</option>
                        <option value="2">Q2 (Oct - Dec)</option>
                        <option value="3">Q3 (Jan - Mar)</option>
                        <option value="4">Q4 (Apr - Jun)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Report Period</label>
                    <p id="modal-period" style="font-weight: bold; font-size: 16px; color: #1976d2;"></p>
                </div>
                
                <div class="form-group">
                    <label for="modal-notes-input" class="form-label">Notes / Comments (Optional)</label>
                    <textarea id="modal-notes-input" class="form-control" rows="4" placeholder="Add notes or comments for this report..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="reportsPage.closeGenerateModal()">Cancel</button>
                <button id="modal-generate-btn" class="btn btn-primary">Generate Report</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="js/generatereport.js"></script>

</body>
</html>