# DocuSeal Email Configuration

## Quick Setup (If you have Azure CLI)

Run this script:
```powershell
.\configure-docuseal-email.ps1
```

This will automatically add SMTP settings and restart DocuSeal.

---

## Manual Setup (Azure Portal)

### Step 1: Go to Azure Portal
1. Open: https://portal.azure.com
2. Navigate to: **App Services** → **stmichael-sign**
3. Click: **Configuration** (in left menu)
4. Click: **Application settings** tab

### Step 2: Add SMTP Settings

Click **+ New application setting** for each of these:

| Name | Value |
|------|-------|
| `SMTP_ADDRESS` | `smtp.gmail.com` |
| `SMTP_PORT` | `587` |
| `SMTP_USERNAME` | `chairman@erotc.org` |
| `SMTP_PASSWORD` | `afdtsrwrxhtcfhlh` (no spaces) |
| `SMTP_FROM` | `St Michael Church <chairman@erotc.org>` |
| `SMTP_DOMAIN` | `gmail.com` |
| `SMTP_AUTHENTICATION` | `plain` |
| `SMTP_ENABLE_STARTTLS_AUTO` | `true` |
| `SMTP_OPENSSL_VERIFY_MODE` | `none` |

### Step 3: Save and Restart

1. Click **Save** at the top
2. Click **Continue** to confirm
3. Go back to **Overview** page
4. Click **Restart**
5. Wait 1-2 minutes for restart to complete

---

## Verify Email is Working

### Test 1: Check Settings in DocuSeal
1. Go to: https://sign.erotc.org
2. Login with your admin account
3. Go to: **Settings** → **Email**
4. You should see the SMTP settings configured

### Test 2: Send a Test Document
1. Create a new document template
2. Send it to someone (or yourself at another email)
3. Check if they receive the email notification

---

## Current Configuration

**Your SMTP Settings:**
- **Server**: smtp.gmail.com:587
- **Email**: chairman@erotc.org
- **App Password**: afdt srwr xhtc fhlh (spaces removed when configured)
- **From Name**: St Michael Church

**Gmail App Password Info:**
- This is a 16-character password generated by Google
- It's different from your regular Gmail password
- Used for apps that don't support 2-factor authentication
- If it doesn't work, generate a new one at: https://myaccount.google.com/apppasswords

---

## Troubleshooting

### Email not sending?

**Check 1: Verify settings in Azure**
```powershell
az webapp config appsettings list --resource-group DefaultResourceGroup-EAU --name stmichael-sign
```

**Check 2: View DocuSeal logs**
1. Azure Portal → App Services → stmichael-sign
2. Click: **Log stream** (in left menu)
3. Look for SMTP or email-related errors

**Check 3: Test Gmail credentials**
Try logging into Gmail with:
- Email: chairman@erotc.org
- App Password: afdt srwr xhtc fhlh

If login fails, regenerate the app password.

### Common Issues

**Issue**: "Authentication failed"
- **Solution**: Regenerate Gmail App Password

**Issue**: "Connection timeout"
- **Solution**: Check if port 587 is blocked by firewall

**Issue**: "Invalid credentials"
- **Solution**: Make sure app password has no spaces

---

## Alternative: Use SendGrid (Azure Native)

If Gmail doesn't work, you can use Azure's SendGrid:

1. Create SendGrid account in Azure Portal
2. Get API key
3. Update DocuSeal settings:
   ```
   SMTP_ADDRESS = smtp.sendgrid.net
   SMTP_PORT = 587
   SMTP_USERNAME = apikey
   SMTP_PASSWORD = <your-sendgrid-api-key>
   ```

---

## Summary

Your DocuSeal at `https://sign.erotc.org` will send emails from `chairman@erotc.org` using Gmail's SMTP server. Recipients will see emails from "St Michael Church" when they receive document signing requests.
